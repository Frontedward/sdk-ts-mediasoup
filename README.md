# SDK для видеозвонков на базе Mediasoup

Этот проект представляет собой SDK для клиентских приложений, который обеспечивает подключение к медиа-серверу на базе Mediasoup и предоставляет удобные абстракции для работы с видеозвонками.

## Основные возможности

- Подключение к видеозвонкам через WebSocket
- Управление медиа-транспортами (send/recv)
- Работа с аудио и видео потоками
- Поддержка симулкаста для видео
- Асинхронная очередь событий
- Типизированные события
- Интеграция с MobX для управления состоянием
- Автоматическое переподключение при разрыве соединения

## Требования

- Node.js 18+
- npm или yarn
- Современный браузер с поддержкой WebRTC

## Установка

```bash
npm install
```

## Разработка

Для запуска проекта в режиме разработки:

```bash
npm run dev
```

Для сборки проекта:

```bash
npm run build
```

Для запуска тестов:

```bash
npm test
```

## Структура проекта

```
src/
  ├── sdk/                    # Основной код SDK
  │   ├── events/            # Обработка событий
  │   ├── media/             # Работа с медиа
  │   ├── signaling/         # Сигналинг
  │   ├── store/             # MobX store
  │   └── types.ts           # Типы и интерфейсы
  ├── demo/                  # Демо-приложение
  └── __tests__/            # Тесты
```

## Использование SDK

```typescript
import { VideoCallClient } from './sdk/video-call-client';

// Создание клиента
const client = new VideoCallClient({
  signalingUrl: 'ws://localhost:3000',
  autoReconnect: true,
  useSimulcast: true
});

// Подписка на события
client.on('connectionStatusChanged', (status) => {
  console.log('Статус соединения:', status);
});

client.on('participantJoined', (participant) => {
  console.log('Участник присоединился:', participant);
});

// Подключение к звонку
try {
  await client.joinCall('room-123', 'user-456', 'Иван Иванов');
  
  // Включение/выключение видео
  await client.enableVideo(true);
  
  // Включение/выключение аудио
  await client.enableAudio(true);
  
} catch (error) {
  console.error('Ошибка подключения:', error);
}

// Отключение от звонка
await client.leaveCall();
```

## Архитектурные особенности

1. **Асинхронная очередь событий**
   - Гарантирует последовательную обработку сигналинг-сообщений
   - Предотвращает гонки состояний при создании транспортов

2. **Типизированные события**
   - Строгая типизация всех событий SDK
   - Автодополнение в IDE
   - Предотвращение ошибок при работе с событиями

3. **MobX интеграция**
   - Реактивное управление состоянием
   - Автоматическое обновление UI при изменении состояния
   - Предсказуемые обновления состояния

4. **Обработка ошибок**
   - Детальная типизация ошибок
   - Автоматическое восстановление при сбоях
   - Информативные сообщения об ошибках

## Планы по улучшению

1. **Масштабируемость**
   - Поддержка нескольких медиа-серверов
   - Балансировка нагрузки
   - Механизм failover

2. **Устойчивость**
   - Улучшенная обработка сетевых сбоев
   - Автоматическое переподключение
   - Сохранение состояния при переподключении

3. **Производительность**
   - Оптимизация использования ресурсов
   - Адаптивное качество видео
   - Эффективное управление памятью